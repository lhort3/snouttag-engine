<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tag Setup - SnoutTag</title>
<meta name="theme-color" content="#578ff6">
<link rel="apple-touch-icon" href="https://app.snoutpet.co.uk/assets/pwaicon.png">

<style>
:root {
  --stratus-blue: #578ff6;
  --bg: #f7f9fc;
  --muted: #6b7280;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  background: var(--bg);
  display: flex;
  justify-content: center;
  align-items: center;
}

.wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
  padding: 0;
}

.container {
  width: 100%;
  max-width: 420px;
  height: 100%;
  max-height: 100vh;
  overflow-y: auto;
  background: white;
  border-radius: 0;
  box-shadow: none;
  padding: 24px;
  box-sizing: border-box;
  text-align: center;
}

.logo {
  width: 90px;
  height: 90px;
  border-radius: 22px;
  overflow: hidden;
  margin: 0 auto 16px;
  box-shadow: 0 6px 20px rgba(87,143,246,0.25);
}
.logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

h1 {
  font-size: 20px;
  margin-bottom: 20px;
}

form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

label {
  text-align: left;
  font-size: 13px;
  color: var(--muted);
}

input, select, textarea {
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  font-size: 15px;
  width: 100%;
  box-sizing: border-box;
}

textarea {
  resize: none;
  height: 70px;
}

.btn {
  background: var(--stratus-blue);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
  transition: background 0.2s ease;
}

.btn:active {
  background: #4477d6;
}

#success {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
  text-align: center;
  padding: 24px;
  box-sizing: border-box;
}

#success img {
  width: 100px;
  height: 100px;
  margin-bottom: 20px;
}

@media (max-height: 700px) {
  .container {
    padding: 16px;
  }
}
</style>
</head>
<body>

<div class="wrapper">
  <div class="container" id="formContainer">
    <div class="logo">
      <img src="https://app.snoutpet.co.uk/assets/pwaicon.png" alt="Logo">
    </div>
    <h1>Tag Setup</h1>
    <form id="tagForm">
      <label>Pet Profile Picture</label>
      <input type="file" id="petPhoto" accept="image/*" required>
      
      <label>Pet Name</label>
      <input type="text" id="petName" required>

      <label>Pet Gender</label>
      <select id="petGender" required>
        <option value="">Select...</option>
        <option>Male</option>
        <option>Female</option>
        <option>Male Neutered</option>
        <option>Female Spayed</option>
      </select>

      <label>Medical Conditions (Leave blank if none)</label>
      <textarea id="petMedical"></textarea>

      <label>Pet Notes (Leave blank if none)</label>
      <textarea id="petNotes"></textarea>

      <label>Breed</label>
      <input type="text" id="petBreed">

      <label>Owner Name</label>
      <input type="text" id="ownerName" required>

      <label>Owner Telephone</label>
      <input type="tel" id="ownerTel" required>

      <label>Owner Address</label>
      <textarea id="ownerAddress"></textarea>

      <label>Owner Email</label>
      <input type="email" id="ownerEmail" required>

      <button type="submit" class="btn">Submit</button>
    </form>
    <h1></h1>
    <h8>The registration system requires a customer support agent to contact you to check the information submitted is correct, and the tag code is active and not already registered.</h8>
    <hr><hr><hr><hr><hr>
  </div>
      
  <div class="container" id="success">
    <img src="https://img.icons8.com/fluency/96/checked.png" alt="Success">
    <h1>Submitted!</h1>
    <p>Your submission is being reviewed. Please allow 24-48 hours for activation.</p>
  </div>
</div>

<script>
const IMGBB_KEY = "8766a6074de7b755de5b070571fe5ccf"; // Replace with your key
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1429190214898942113/-FEfY4XNK55DC2LoFn3LTU68CSoBQBNZC3-EorCeFW02QfAkd6hTAd7IQhfQBPgV3oFF";

async function uploadToImgBB(file) {
  try {
    const formData = new FormData();
    formData.append("image", file);
    const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: formData });
    const data = await res.json();
    if (data.success) return data.data.url;
    else throw new Error();
  } catch {
    return null;
  }
}

async function sendToDiscord(fields, imageUrl) {
  const payload = {
    username: "SnoutTag Bot",
    embeds: [{
      title: "🐶 New Tag Setup Submission",
      color: 5793266,
      fields: [
        { name: "Pet Name", value: fields.petName || "N/A", inline: true },
        { name: "Gender", value: fields.petGender || "N/A", inline: true },
        { name: "Breed", value: fields.petBreed || "N/A", inline: true },
        { name: "Medical Conditions", value: fields.petMedical || "None" },
        { name: "Notes", value: fields.petNotes || "None" },
        { name: "Owner Name", value: fields.ownerName || "N/A", inline: true },
        { name: "Owner Tel", value: fields.ownerTel || "N/A", inline: true },
        { name: "Owner Email", value: fields.ownerEmail || "N/A", inline: true },
        { name: "Owner Address", value: fields.ownerAddress || "N/A" }
      ],
      image: { url: imageUrl || null }
    }]
  };
  try {
    await fetch(DISCORD_WEBHOOK, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  } catch {}
}

document.getElementById("tagForm").addEventListener("submit", async e => {
  e.preventDefault();
  const file = document.getElementById("petPhoto").files[0];
  const fields = {
    petName: document.getElementById("petName").value.trim(),
    petGender: document.getElementById("petGender").value.trim(),
    petMedical: document.getElementById("petMedical").value.trim(),
    petNotes: document.getElementById("petNotes").value.trim(),
    petBreed: document.getElementById("petBreed").value.trim(),
    ownerName: document.getElementById("ownerName").value.trim(),
    ownerTel: document.getElementById("ownerTel").value.trim(),
    ownerAddress: document.getElementById("ownerAddress").value.trim(),
    ownerEmail: document.getElementById("ownerEmail").value.trim()
  };

  const btn = document.querySelector(".btn");
  btn.disabled = true;
  btn.textContent = "Submitting...";

  const imageUrl = file ? await uploadToImgBB(file) : null;
  await sendToDiscord(fields, imageUrl);

  document.getElementById("formContainer").style.display = "none";
  document.getElementById("success").style.display = "flex";
});
</script>

</body>
</html>
